<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Maestro AI</title>
</head>
<body>
  <h1>Maestro AI ðŸŽ¹</h1>
  <button id="generateBtn">Generate Melody</button>
  <pre id="output"></pre>

  <!-- Tone.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>

  <script>
    document.getElementById("generateBtn").onclick = async () => {
      try {
        // Use your deployed backend URL below instead of localhost
        const response = await fetch("https://your-backend-url.onrender.com/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ harmonyData: ["C", "F", "G", "Am"] })
        });

        if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

        const data = await response.json();
        document.getElementById("output").textContent = JSON.stringify(data.melody, null, 2);
        console.log("ðŸŽ¼ Melody received:", data.melody);

        // Start Audio Context
        await Tone.start();

        // PolySynth for flexible playback
        const synth = new Tone.PolySynth(Tone.Synth, {
          oscillator: { type: "triangle" },
          envelope: {
            attack: 0.1,
            decay: 0.2,
            sustain: 0.4,
            release: 1
          }
        }).toDestination();

        // Optional: Add reverb for warmth
        const reverb = new Tone.Reverb({ decay: 2 }).toDestination();
        synth.connect(reverb);

        // Play notes
        let now = Tone.now();
        data.melody.forEach(note => {
          synth.triggerAttackRelease(note.note, note.duration, now);
          now += note.duration;
        });

      } catch (error) {
        console.error("Error:", error);
        document.getElementById("output").textContent = `Error: ${error.message}`;
      }
    };
  </script>
</body>
</html>
